<template>
  <div class="slds-box slds-theme_default">
    <div class="slds-page-header">
      <div class="slds-page-header__row">
        <div class="slds-page-header__col-title">
          <div class="slds-media">
            <div class="slds-media__body">
              <div class="slds-page-header__name">
                <div class="slds-page-header__name-title">
                  <h1>
                    <span
                      class="slds-page-header__title slds-truncate"
                      title="Expense Dashboard"
                      >Expense Dashboard</span
                    >
                  </h1>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Summary Section -->
    <div class="slds-grid slds-gutters slds-wrap">
      <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
        <div class="slds-box slds-box_x-small slds-theme_info">
          <p class="slds-text-title_caps">Total Expenses</p>
          <p class="slds-text-heading_large">{totalAmount}</p>
        </div>
      </div>
      <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
        <div class="slds-box slds-box_x-small slds-theme_success">
          <p class="slds-text-title_caps">Submitted</p>
          <p class="slds-text-heading_large">{submittedCount}</p>
        </div>
      </div>
      <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-3">
        <div class="slds-box slds-box_x-small slds-theme_warning">
          <p class="slds-text-title_caps">Approved</p>
          <p class="slds-text-heading_large">{approvedCount}</p>
        </div>
      </div>
    </div>

    <!-- Controls -->
    <div class="slds-m-top_medium">
      <lightning-button
        label="Add Expense"
        onclick={handleAddExpense}
        variant="brand"
      ></lightning-button>

      <div class="slds-float_right">
        <lightning-combobox
          name="statusFilter"
          label="Filter by Status"
          value={selectedStatus}
          options={statusOptions}
          onchange={handleStatusFilterChange}
        >
        </lightning-combobox>
      </div>
    </div>

    <!-- Add Expense Form -->
    <template if:true={showAddForm}>
      <div class="slds-card slds-m-top_medium">
        <div class="slds-card__header slds-grid">
          <header class="slds-media slds-media_center slds-has-flexi-truncate">
            <div class="slds-media__body">
              <h2
                class="slds-card__header-title slds-truncate"
                title="Add New Expense"
              >
                Add New Expense
              </h2>
            </div>
          </header>
        </div>
        <div class="slds-card__body">
          <div class="slds-form slds-form_stacked">
            <div class="slds-form-element">
              <label class="slds-form-element__label" for="name">Name</label>
              <div class="slds-form-element__control">
                <input
                  type="text"
                  id="name"
                  name="Name"
                  value={newExpense.Name}
                  onchange={handleInputChange}
                  class="slds-input"
                />
              </div>
            </div>

            <div class="slds-form-element">
              <label class="slds-form-element__label" for="amount"
                >Amount</label
              >
              <div class="slds-form-element__control">
                <input
                  type="number"
                  id="amount"
                  name="Amount__c"
                  value={newExpense.Amount__c}
                  onchange={handleInputChange}
                  class="slds-input"
                />
              </div>
            </div>

            <div class="slds-form-element">
              <label class="slds-form-element__label" for="category"
                >Category</label
              >
              <div class="slds-form-element__control">
                <input
                  type="text"
                  id="category"
                  name="Category__c"
                  value={newExpense.Category__c}
                  onchange={handleInputChange}
                  class="slds-input"
                />
              </div>
            </div>

            <div class="slds-form-element">
              <label class="slds-form-element__label" for="date">Date</label>
              <div class="slds-form-element__control">
                <input
                  type="date"
                  id="date"
                  name="Date__c"
                  value={newExpense.Date__c}
                  onchange={handleInputChange}
                  class="slds-input"
                />
              </div>
            </div>

            <div class="slds-form-element">
              <label class="slds-form-element__label" for="status"
                >Status</label
              >
              <div class="slds-form-element__control">
                <select
                  id="status"
                  name="Status__c"
                  value={newExpense.Status__c}
                  onchange={handleInputChange}
                  class="slds-select"
                >
                  <option value="Submitted">Submitted</option>
                  <option value="Approved">Approved</option>
                  <option value="Rejected">Rejected</option>
                </select>
              </div>
            </div>

            <div class="slds-m-top_medium">
              <lightning-button
                label="Save"
                variant="brand"
                onclick={handleSaveExpense}
              ></lightning-button>
              <lightning-button
                label="Cancel"
                variant="neutral"
                onclick={handleCancel}
                class="slds-m-left_small"
              ></lightning-button>
            </div>
          </div>
        </div>
      </div>
    </template>

    <!-- Expenses Table -->
    <div class="slds-m-top_medium">
      <div class="slds-card">
        <div class="slds-card__header slds-grid">
          <header class="slds-media slds-media_center slds-has-flexi-truncate">
            <div class="slds-media__body">
              <h2
                class="slds-card__header-title slds-truncate"
                title="Expenses"
              >
                Expenses
              </h2>
            </div>
          </header>
        </div>
        <div class="slds-card__body">
          <template if:true={filteredExpenses.length}>
            <div class="slds-table_container">
              <table
                class="slds-table slds-table_bordered slds-table_cell-buffer"
              >
                <thead>
                  <tr class="slds-line-height_reset">
                    <th scope="col">
                      <div class="slds-th__action slds-text-heading_label">
                        Name
                      </div>
                    </th>
                    <th scope="col">
                      <div class="slds-th__action slds-text-heading_label">
                        Amount
                      </div>
                    </th>
                    <th scope="col">
                      <div class="slds-th__action slds-text-heading_label">
                        Category
                      </div>
                    </th>
                    <th scope="col">
                      <div class="slds-th__action slds-text-heading_label">
                        Date
                      </div>
                    </th>
                    <th scope="col">
                      <div class="slds-th__action slds-text-heading_label">
                        Status
                      </div>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <template for:each={filteredExpenses} for:item="expense">
                    <tr key={expense.Id} class="slds-hint-parent">
                      <td data-label="Name">
                        <div class="slds-truncate" title={expense.Name}>
                          {expense.Name}
                        </div>
                      </td>
                      <td data-label="Amount">
                        <div class="slds-truncate" title={expense.Amount__c}>
                          {expense.Amount__c}
                        </div>
                      </td>
                      <td data-label="Category">
                        <div class="slds-truncate" title={expense.Category__c}>
                          {expense.Category__c}
                        </div>
                      </td>
                      <td data-label="Date">
                        <div class="slds-truncate" title={expense.Date__c}>
                          {expense.Date__c}
                        </div>
                      </td>
                      <td data-label="Status">
                        <div class="slds-truncate">
                          <lightning-combobox
                            value={expense.Status__c}
                            data-id={expense.Id}
                            options={statusOptions}
                            onchange={handleStatusChange}
                          >
                          </lightning-combobox>
                        </div>
                      </td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>
          </template>

          <template if:false={filteredExpenses.length}>
            <p class="slds-text-align_center">No expenses found.</p>
          </template>
        </div>
      </div>
    </div>
  </div>
</template>
