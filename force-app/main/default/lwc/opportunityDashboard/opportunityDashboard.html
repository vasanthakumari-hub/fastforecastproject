<template>
  <div class="slds-card">
    <div class="slds-card__header slds-grid">
      <header class="slds-media slds-media_center slds-has-flexi-truncate">
        <div class="slds-media__body">
          <h2
            class="slds-card__header-title slds-truncate"
            title="Opportunity Dashboard"
          >
            Opportunity Dashboard
          </h2>
        </div>
      </header>
    </div>
    <div class="slds-card__body">
      <template if:true={isLoading}>
        <lightning-spinner
          alternative-text="Loading opportunity data"
        ></lightning-spinner>
      </template>

      <template if:false={isLoading}>
        <template if:true={error}>
          <div
            class="slds-notify slds-notify_alert slds-theme_error"
            role="alert"
          >
            <span class="slds-assistive-text">Error</span>
            <h2>Error loading opportunities: {error.body.message}</h2>
          </div>
        </template>

        <template if:true={opportunities.length}>
          <div class="slds-table_container">
            <table
              class="slds-table slds-table_bordered slds-table_cell-buffer"
            >
              <thead>
                <tr class="slds-line-height_reset">
                  <th scope="col">
                    <div class="slds-th__action slds-text-heading_label">
                      Account Name
                    </div>
                  </th>
                  <th scope="col">
                    <div class="slds-th__action slds-text-heading_label">
                      Opportunity Name
                    </div>
                  </th>
                  <th scope="col">
                    <div class="slds-th__action slds-text-heading_label">
                      Amount
                    </div>
                  </th>
                  <th scope="col">
                    <div class="slds-th__action slds-text-heading_label">
                      Close Date
                    </div>
                  </th>
                  <th scope="col">
                    <div class="slds-th__action slds-text-heading_label">
                      Stage
                    </div>
                  </th>
                  <th scope="col">
                    <div class="slds-th__action slds-text-heading_label">
                      Contact Name
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody>
                <template for:each={opportunities} for:item="opp">
                  <tr key={opp.Opportunity.Id} class="slds-hint-parent">
                    <td data-label="Account Name">
                      <div class="slds-truncate" title={opp.Account.Name}>
                        {opp.Account.Name}
                      </div>
                    </td>
                    <td data-label="Opportunity Name">
                      <div class="slds-truncate" title={opp.Opportunity.Name}>
                        {opp.Opportunity.Name}
                      </div>
                    </td>
                    <td data-label="Amount">
                      <div class="slds-truncate" title={opp.Opportunity.Amount}>
                        {opp.Opportunity.Amount}
                      </div>
                    </td>
                    <td data-label="Close Date">
                      <div
                        class="slds-truncate"
                        title={opp.Opportunity.CloseDate}
                      >
                        {opp.Opportunity.CloseDate}
                      </div>
                    </td>
                    <td data-label="Stage">
                      <div
                        class="slds-truncate"
                        title={opp.Opportunity.StageName}
                      >
                        {opp.Opportunity.StageName}
                      </div>
                    </td>
                    <td data-label="Contact Name">
                      <div class="slds-truncate" title={opp.Contact.Name}>
                        {opp.Contact.Name}
                      </div>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </template>

        <template if:false={opportunities.length}>
          <p>No open opportunities found.</p>
        </template>
      </template>
    </div>
  </div>
</template>
