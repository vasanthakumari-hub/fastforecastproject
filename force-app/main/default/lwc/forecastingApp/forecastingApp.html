<template>
  <div class="slds-card">
    <div class="slds-card__header slds-grid">
      <header class="slds-media slds-media_center slds-has-flexi-truncate">
        <div class="slds-media__body">
          <h2
            class="slds-card__header-title slds-truncate"
            title="Sales Forecast"
          >
            Sales Forecast
          </h2>
        </div>
      </header>
    </div>
    <div class="slds-card__body">
      <!-- Add a button to trigger forecast calculation -->
      <div class="slds-m-bottom_small">
        <lightning-button
          label="Calculate Forecast"
          title="Calculate Forecast"
          onclick={handleCalculateForecast}
        ></lightning-button>
      </div>

      <template if:true={isLoading}>
        <lightning-spinner
          alternative-text="Loading forecast data"
        ></lightning-spinner>
      </template>

      <template if:false={isLoading}>
        <template if:true={error}>
          <div
            class="slds-notify slds-notify_alert slds-theme_error"
            role="alert"
          >
            <span class="slds-assistive-text">Error</span>
            <h2>Error loading forecasts: {error.body.message}</h2>
          </div>
        </template>

        <template if:true={forecasts.length}>
          <div class="slds-table_container">
            <table
              class="slds-table slds-table_bordered slds-table_cell-buffer"
            >
              <thead>
                <tr class="slds-line-height_reset">
                  <th scope="col">
                    <div class="slds-th__action slds-text-heading_label">
                      Period
                    </div>
                  </th>
                  <th scope="col">
                    <div class="slds-th__action slds-text-heading_label">
                      Amount
                    </div>
                  </th>
                  <th scope="col">
                    <div class="slds-th__action slds-text-heading_label">
                      Forecast Date
                    </div>
                  </th>
                  <th scope="col">
                    <div class="slds-th__action slds-text-heading_label">
                      Type
                    </div>
                  </th>
                  <th scope="col">
                    <div class="slds-th__action slds-text-heading_label">
                      Account
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody>
                <template for:each={forecasts} for:item="forecast">
                  <tr key={forecast.Id} class="slds-hint-parent">
                    <td data-label="Period">
                      <div class="slds-truncate" title={forecast.Period__c}>
                        {forecast.Period__c}
                      </div>
                    </td>
                    <td data-label="Amount">
                      <div class="slds-truncate" title={forecast.Amount__c}>
                        {forecast.Amount__c}
                      </div>
                    </td>
                    <td data-label="Forecast Date">
                      <div
                        class="slds-truncate"
                        title={forecast.ForecastDate__c}
                      >
                        {forecast.ForecastDate__c}
                      </div>
                    </td>
                    <td data-label="Type">
                      <div
                        class="slds-truncate"
                        title={forecast.ForecastType__c}
                      >
                        {forecast.ForecastType__c}
                      </div>
                    </td>
                    <td data-label="Account">
                      <div
                        class="slds-truncate"
                        title={forecast.AccountId__r.Name}
                      >
                        {forecast.AccountId__r.Name}
                      </div>
                    </td>
                  </tr>
                </template>
              </tbody>
            </table>
          </div>
        </template>

        <template if:false={forecasts.length}>
          <p>No forecast data available.</p>
        </template>
      </template>
    </div>
  </div>
</template>
